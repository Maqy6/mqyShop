var baxiaJsonpHandler=function(){"use strict";var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};var t=function(){return(t=Object.assign||function(e){for(var t,n=arguments,i=1,o=arguments.length;o>i;i++)for(var r in t=n[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},n=window,i=function(e,t){var i=n.__baxia__||{};return e?i[e]||t:i},o=function(e,t){n.__baxia__=n.__baxia__||{},n.__baxia__[e]=t},r=location,a=document,s=function(e,t,n){(void 0===t&&(t=1),void 0===n&&(n=.1),0>=n||Math.random()<n)&&function(e,t){var n=[];for(var i in e)n.push(i+"="+encodeURIComponent(e[i]));(new Image).src=t+n.join("&")}({code:t,msg:(e+"").substr(0,1e3)+";v:"+d,pid:"baxia",page:r.href.split(/[#?]/)[0],query:r.search.substr(1),hash:r.hash,referrer:a.referrer,title:a.title,ua:navigator.userAgent},"//gm.mmstat.com/fsp.1.1?")};var l=function(){return navigator.userAgent.match(/.*(iPhone|iPad|Android|ios|SymbianOS|Windows Phone).*/i)};var d="2.5.6",c={},u=i("events",{}),p={on:function(e,t){return(u[e]||(u[e]=[])).push(t),o("events",u),c},once:function(e,t){var n=this,i=function(){t.apply(n,function(e){for(var t=Array(e.length),n=0;t.length>n;++n)t[n]=e[n];return t}(arguments)),n.off(e,i)};return this.on(e,i),c},off:function(e,t){if(!e&&!t)return u={},c;var n=u[e];if(n)if(t)for(var i=n.length-1;i>=0;i--)n[i]===t&&n.splice(i,1);else delete u[e];return c},fire:function(e,t){var n=(u=i("events",{}))[e];if(n)for(var o=0,r=(n=n.slice()).length;r>o;o++)n[o](t);return c}},h="@=_=@",f=null,g=null,m=null,y=[],v={uid:0,hid:-1,q:[],tm:0,postMessage:function(e,t){var n=++v.uid,i=v.q,o={name:+new Date+""+n+"^"+document.domain+"&"+t,uid:n,target:e};i.push(o),v.tm||(v.tm=setInterval(function(){var e=v.q;if(0!==e.length&&e[0].uid>v.hid){var t=e[0];v.hid=t.uid,t.target.name=t.name}},10))},ListenerMessage:function(e,t){var n="",i=/^(\d+?)\^(.+?)&(.*?)$/;setInterval(function(){if(!e)return!1;var o=e.name;if(o!==n){v.q.shift(),n=o;var r=i.exec(o);if(!r)return;t&&t({origin:r[2],data:r[3]})}},10)}};function x(e){try{var t=e.data.split(h),n=void 0,i=void 0;t.length>1?(n=t[0],i=t[1]):(n=(t=JSON.parse(t[0])).type,i=t.content);for(var o=0,r=y.length;r>o;o++)y[o].event===n&&y[o].callback(i)}catch(a){}}var b={initListener:function(e){g=e.originWin,m=e.msgTransfer,(f=e.currentWin)&&g&&m&&(f.postMessage?f.addEventListener?f.addEventListener("message",x,!1):f.attachEvent&&f.attachEvent("onmessage",x):v.ListenerMessage("fromFrame"==m?g:f,x))},register:function(e,t){y.push({event:e,callback:t})},send:function(e){var t=e.type+h+e.content;f&&g&&m&&(g.postMessage?g.postMessage(t,"*"):v.postMessage("fromFrame"==m?g:f,t))}};o("Messenger",b);var w=function(e,t,n,i){if(void 0===i&&(i=!1),t.addEventListener)t.addEventListener(e,n,i);else if(t.attachEvent)return t.attachEvent("on"+e,n),!1};function _(e,t){return e+(e.indexOf("?")>-1?"&":"?")+t}!function(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===n&&i.firstChild?i.insertBefore(o,i.firstChild):i.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}(".baxia-dialog {\n  position: fixed;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  z-index: 2147483647;\n}\n\n.baxia-dialog-mask {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background: #000;\n  opacity: .5;\n  filter:alpha(opacity=50);\n}\n\n.sufei-dialog {\n  opacity: 0;\n}\n\n.baxia-dialog-close {\n  position: absolute;\n  top: 20px;\n  right: 24px;\n  cursor: pointer;\n  transform: scaleY(0.8);\n  -ms-transform: scaleY(0.8);\n  /* IE 9 */\n  -moz-transform: scaleY(0.8);\n  /* Firefox */\n  -webkit-transform: scaleY(0.8);\n  /* Safari 和 Chrome */\n  -o-transform: scaleY(0.8);\n  font-size: 16px;\n  /* padding:10px; */\n  width: 10px;\n  height: 10px;\n}\n\n.baxia-dialog-content {\n  position: absolute;\n  margin: auto;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  width: 420px;\n  /* min-width: 420px; */\n  height: 320px;\n}\n\n.baxia-mobile .baxia-dialog-content {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  margin: 0;\n  min-width: auto;\n  top: 0;\n  left: 0;\n}\n\n.baxia-mobile .baxia-dialog-content iframe {\n  border-radius: 0;\n}\n\n.baxia-dialog.map .baxia-dialog-content {\n  height: 100%;\n  width: 100%;\n  position: static;\n  margin: 0;\n  /* height: 700px;\n  min-width: 800px;\n  left: 50%;\n  top: 50%;\n  margin: -350px 0 0 -400px; */\n}\n.baxia-dialog.map  .baxia-dialog-mask{\n  display: none;\n}\n\n.baxia-dialog-content iframe {\n  width: 100%;\n  height: 100%;\n  border: 0;\n  background: #fff;\n  border-radius: 18px;\n}\n\n.baxia-ios-fix-fixed .baxia-dialog {\n  position: absolute;\n}\n@media screen and (max-height:720px) {\n  .baxia-dialog-content.map {\n    top: 50%;\n    left: 50%;\n    min-width: 520px;\n    height: 520px;\n    margin: -260px 0 0 -260px;\n  }\n}\n\n.custom-dialog-wrapper .nc-container .nc_scale span{\n  height: auto;\n}");var M=document,T=function(e,t,n,i){if(!e)return t();var o=M.getElementsByTagName("script")[0],r=M.createElement("script");if(r.async=!0,r.src=e,i&&(r.bxOriginUrl=i),e.indexOf("alicdn")>-1&&(r.crossOrigin=!0),r.onerror=function(t){s("function:loadJS. msg:"+e+"load error。props："+JSON.stringify(n)),r.onerror=null},t){var a=!1;r.onload=r.onreadystatechange=function(){a||r.readyState&&!/loaded|complete/.test(r.readyState)||(r.onload=r.onreadystatechange=null,a=!0,t())}}o.parentNode.insertBefore(r,o)},S=null,C=l(),O=function(e){if(e.renderNC=e.renderNC||location.search.indexOf("renderNC")>-1,e.renderNC)if(function(e){if(e&&!document.getElementById(e.id))return!1;var t=e&&e.querySelector(".nc_wrapper"),n=e&&e.querySelector("._nc");return!!t||!!n}(e.renderTo))console.log("已经渲染或者 DOM 元素不存在");else{var t,n,i,r="";e.cssLink&&(t=e.cssLink,n=document.getElementsByTagName("head")[0],(i=document.createElement("link")).type="text/css",i.rel="stylesheet",i.href=t,n.appendChild(i)),C?(r="register_h5",T("//g.alicdn.com/sd/nch5/index.js",function(){S=window.NoCaptcha,c.bannerHidden=!1,S.init(c),S.setEnabled(!0)})):(r="register",T("//g.alicdn.com/sd/ncpc/nc.js",function(){S=new window.noCaptcha(c)}));var a=e.verifiedCallback,s=e.showCallback,l=e.ncAppkey,d=e.ncToken,c={renderTo:"#"+e.renderTo.id,appkey:void 0===l?"NCAPPKEY":l,token:void 0===d?"NCTOKENSTR":d,bannerHidden:!1,scene:r,replaceCallback:function(e,t,n){var i,r=[];C?i=n.bind(this,"ok"):(i=e.success,t=e.data),r.push({key:"bx-nc-ua",value:t.n}),o("ncData",r),o("ncSlideData",t),i({success:!0,result:{code:0}}),a&&a()},language:e.ncLanguage};s&&s()}},k=function(e){return void 0===e&&(e={}),"https://"+e.HOST+e.PATH};function E(e,t,n){var i=function(e,t){return{data:{slidedata:JSON.stringify(t.data),x5secdata:e.SECDATA},url:k(e)+"/_____tmd_____/slide"}}(e,t);N({url:i.url,type:"GET",dataType:"json",data:i.data,success:function(e,t){n(!0)},error:function(e){n(!1)}})}var N=function(e){e=e||{};var t=[];for(var n in e.data)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e.data[n]));t.push(("v="+Math.random()).replace(".",""));var i=t.join("&"),o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState){var t=o.status;t>=200&&300>t?e.success&&e.success(o.responseText,o.responseXML):e.error&&e.error(t)}},"GET"===e.type?(o.open("GET",e.url+"?"+i,!0),o.send(null)):"POST"===e.type&&(o.open("POST",e.url,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(i))},L=document,H=window,I=l(),R="false",q=["captchacapslidev2","captchascene","captchacappuzzle","captcharecaptcha"];function D(e){return L.querySelector(e)}function W(e){return JSON.parse(e)}return function(t){function n(e){return void 0===e&&(e={}),t.call(this,e)||this}return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}(n,t),n.prototype.fail=function(){this.forEachQueue(function(e){e.fail()})},n.prototype.resend=function(){this.forEachQueue(function(e){T(e.bxOriginUrl||e.url,function(){e.done()})})},n}(function(){function e(e){this.queue=[];this.dialog=null,this.reset(),this.on=p.on}return e.prototype.handler=function(e){this.props=this.formatProps(e),this.options=i("options")||{},this.run(e)},e.prototype.formatProps=function(e){var t,n=e&&e.result;if("string"==typeof n&&n)try{n=JSON.parse(n)}catch(i){try{void 0===(t=n)&&(t=""),n=t.substring(t.indexOf("{"),t.lastIndexOf("}")+1),n=JSON.parse(n+"")}catch(i){throw"baxia.js data error"}}return n.url=n.url||n.data&&n.data.url||"",e.result=n,e},e.prototype.showDialog=function(e){var t=e.url,n=e.h5url;if(I&&n&&(t=n,e.url=n),t){if(this.options&&(this.options.language&&(t=_(t,"language="+this.options.language)),this.options.ncLanguage&&(t=_(t,"ncLanguage="+this.options.ncLanguage))),t&&-1===t.indexOf("http"))t=this.getDomain(this.currentRequest.url)+t;var i=t.match(/action=([^&]+)/);i&&(this.props.result.action=i[1]);var o=t.match(/pureCaptcha=([^&]+)/);o&&(this.props.result.pureCaptcha=o[1]);var r=t.match(/pureDenyWait=([^&]+)/);r&&(this.props.result.pureDenyWait=r[1]),this.dialog||D("#baxia-dialog-content")?this.show(t):(this.render(e),this.show(t))}},e.prototype.hide=function(e){void 0===e&&(e=!1),e?this.resend():this.fail();try{if(this.dialog){if("none"===this.dialog.style.display)return;this.dialog.style.display="none"}p.fire("event:dialogHide@baxia",{validateSuccess:e}),this.reset(),this.closeSufei()}catch(t){throw s("【Hide Step】Hide error, message: "+t.message+", stack: "+t.stack,16,1),Error(t)}this.options&&this.options.hideCallback&&this.options.hideCallback(e)},e.prototype.closeSufei=function(){try{setTimeout(function(){D(".sufei-dialog")&&H.parent&&H.parent.postMessage&&H.parent.postMessage(JSON.stringify({type:"child",content:'{"smToken":"","sm":""}'}),"*")},200)}catch(e){s("closeSufei"+e.message)}},e.prototype.destroy=function(){this.reset(),this.dialog&&(this.dialog.innerHTML="",this.dialog=null),this.options&&this.options.renderTo&&(this.options.renderTo.innerHTML="")},e.prototype.show=function(e){e&&this.frame&&this.frame.src!=e&&-1>=e.indexOf("renderIframe")&&(this.frame.src=e),this.dialog&&(this.dialog.style.display="block"),p.fire("event:dialogShow@baxia"),this.options&&this.options.showCallback&&this.options.showCallback(e)},e.prototype.canRenderTo=function(){var e,t,n,i,o,r,a;return!(!this.options.renderTo||this.options.renderNC)&&(null===(e=this.props.result)||void 0===e||!e.action||("captcha"===(null===(t=this.props.result)||void 0===t?void 0:t.action)?!!(null===(n=this.props.result)||void 0===n?void 0:n.pureCaptcha):"deny"===(null===(i=this.props.result)||void 0===i?void 0:i.action)||"wait"===(null===(o=this.props.result)||void 0===o?void 0:o.action)?!!(null===(r=this.props.result)||void 0===r?void 0:r.pureDenyWait):0>q.indexOf(null===(a=this.props.result)||void 0===a?void 0:a.action)))},e.prototype.render=function(e){var t,n=this,i=this,o="420px",r="320px",a=e.url,l=e.dialogSize,d=this.options,c=d.dialogSize;I||(d.autoSize?(t=this.getDialogSize(c||l),w("resize",H,function(){t=n.getDialogSize(c||l),i.frame.parentElement.style.width=t.width,i.frame.parentElement.style.height=t.height})):t=c||l),t&&(o=t.width||"420px",r=t.height||"320px");var u=L.createElement("div"),p=this.options.renderTo;u.style.display="none";var h=this.canRenderTo(),f="",g=L.body;if(h?(g=p,f=this.getRenderContainer()):f='<div class="baxia-dialog-mask"></div><div class="baxia-dialog-content"'+(t?'style="width:'+o+";height:"+r+';"':"")+">\n      "+this.getRenderContainer()+'\n      <div class="baxia-dialog-close">X</div>\n      </div>',u.innerHTML=f,!h&&!g)return H&&w("load",H,function(){L.body.appendChild(u),i.renderDialog(h,u,a),i.show(a)}),void s("body未渲染时弹窗:"+location.href);g.appendChild(u),this.renderDialog(h,u,a)},e.prototype.getDialogSize=function(e){var t,n,i,o,r=420,a=320;if(e&&(t=e.width||"",n=e.height||"",t.indexOf("px")>-1&&(r=+t.replace("px","")),n.indexOf("px")>-1&&(a=+n.replace("px","")),t.indexOf("%")>-1&&(i=t,r=+t.replace("%","")/100*window.innerWidth),n.indexOf("%")>-1&&(o=n,a=+n.replace("%","")/100*window.innerHeight)),window.innerWidth/window.innerHeight<r/a){if(window.innerWidth<r)return{width:window.innerWidth+"px",height:Math.round(window.innerWidth*a/r)+"px"}}else if(window.innerHeight<a)return{width:Math.round(window.innerHeight*r/a)+"px",height:window.innerHeight+"px"};return{width:i||r+"px",height:o||a+"px"}},e.prototype.renderDialog=function(e,n,i){var o=this,r=D(".baxia-dialog-close");e||w("click",r,function(){o.hide()}),o.dialog=n,o.frame=D("#baxia-dialog-content"),o.frame&&o.initMessenger(o.frame.contentWindow),R=o.props.result.fullScreen||o.props.result.data&&o.props.result.data.fullScreen||"false",o.dialogStyleFix(n),!I&&"true"!==R||e||o.mobileFix(),i.indexOf("/assist")>-1&&(r.style.display="none",800>screen.width||(n.className=n.className+" map")),this.props.result.renderNC?this.handleRenderNC(t({},this.props.result)):"renderIframe"!==this.props.result.url||this.handleShowIframeDialog()},e.prototype.getRenderContainer=function(){var e=this.props.result,t=e.url,n=e.action;return this.props.result.renderNC?'<div id="baxia-nc-container"></div>':"renderIframe"===t?'<iframe id="baxia-dialog-content" frameborder="none"></iframe>':'<iframe id="baxia-dialog-content" frameborder="none" src="'+t+'"'+("captcha"===n&&e.pureCaptcha||("deny"===n||"wait"===n)&&e.pureDenyWait?' style="height:34px"':"")+"></iframe>"},e.prototype.initMessenger=function(e){var t=this;b.initListener({currentWin:H,originWin:e,msgTransfer:"fromFrame"}),b.register("msg:validateSuccess@sufei",function(e){t.hide(!0)}),b.register("child",function(e){if(!(e=W(decodeURIComponent(e))).queryToken&&!e.smToken)return t.hide();e.queryToken="not-send"===e.smToken?"":"smToken=success",t.hide(!0)}),b.register("callApp",function(e){var t;e=W(decodeURIComponent(e));try{"alipays:"!==(t=new URL(e.url)).protocol&&(t=null)}catch(n){t=null}t?location.href=t.href:s("callApp url invalied:"+e.url)}),b.register("msg:changeHeight",function(e){var t=D("#baxia-dialog-content");t.style.height=e+"px",t.style.position="static"})},e.prototype.dialogStyleFix=function(e){this.canRenderTo()?e.className+=" custom-dialog-wrapper":(e.className=" baxia-dialog auto ",(I||"true"===R)&&(e.className+=" baxia-mobile"))},e.prototype.reset=function(){this.currentRequest=null,this.queue=[],this.status=0},e.prototype.getDomain=function(e){if(!e)return"";var t=e.match(/(https|http):\/\/([^\/]+)\//i);return t?t[0]:""},e.prototype.mobileFix=function(){var e=L.body,t=0,n=this.dialog,i=e.style.height,o=H.dpr||1,r=document.documentElement.getBoundingClientRect(),a=Math.max(r.width,H.innerWidth)/o;n.style.cssText=["-webkit-transform:scale("+o+") translateZ(0)","-ms-transform:scale("+o+") translateZ(0)","transform:scale("+o+") translateZ(0)","-webkit-transform-origin:0 0;-ms-transform-origin:0 0;transform-origin:0 0","width:"+a+"px","height:"+Math.max(r.height,H.innerHeight)/o+"px","z-index:2147483647;position: fixed;left:0;top:0px","background:"+(a>800?"rgba(0,0,0,.5)":"#FFF"),"display:none"].join(";"),p.on("event:dialogShow@baxia",function(){t=H.pageYOffset||L.documentElement.scrollTop||e.scrollTop,n.style.height=Math.max(H.innerHeight,e.scrollHeight)>H.screen.height?H.screen.height+"px":"100%",e.style.height=n.style.height,setTimeout(function(){e.scrollTop=0;try{H.scrollTo&&H.scrollTo(0,0)}catch(t){}},200)}),p.on("event:dialogHide@baxia",function(){e.scrollTop=t,e.style.height=i;try{H.scrollTo&&H.scrollTo(0,t)}catch(n){}})},e.prototype.run=function(e){var t=e.result,n=e.config,i=e.checkJsFlag;200!==this.status?(this.currentRequest=this.currentRequest||n,this.status=200,i?(this.autoSample(t),this.resend()):this.showDialog(t)):this.queue.push(n)},e.prototype.autoSample=function(e){try{var t=L&&!!L._sufei_data2;"string"==typeof e&&(e=JSON.parse(e));var n="https://fourier.taobao.com/ts?ext=200&uuid="+e.uuid+"&serid="+e.serid+"&sufei="+t;H.location&&location.href&&(n=n+"&href=="+location.href.substr(0,128)),H.__fyModule&&(n=n+"&fyModuleLoad="+H.__fyModule.load+"&fyModuleInit="+H.__fyModule.init),H.__umModule&&(n=n+"&umModuleLoad="+H.__umModule.load+"&umModuleInit="+H.__umModule.init),H.__uabModule&&(n=n+"&uabModuleLoad="+H.__uabModule.load+"&uabModuleInit="+H.__uabModule.init),H.__ncModule&&(n=n+"&ncModuleLoad="+H.__ncModule.load+"&ncModuleInit="+H.__ncModule.init),H.__nsModule&&(n=n+"&nsModuleLoad="+H.__nsModule.load+"&nsModuleInit="+H.__nsModule.init),H.__etModule&&(n=n+"&etModuleLoad="+H.__etModule.load+"&etModuleInit="+H.__etModule.init),(new Image).src=n}catch(i){s("checkJsFlagFailed")}},e.prototype.forEachQueue=function(e){for(var t=[this.currentRequest].concat(this.queue),n=0;t.length>n;n++)if(t[n]){if(t[n].url&&t[n].url.indexOf("reqeust=getpunishpage")>-1&&0>t[n].url.indexOf("source=xagent")||t[n].xhr&&!t[n].xhr.openParams||t[n].xhr&&t[n].xhr.bxOriginXhr&&!t[n].xhr.bxOriginXhr.openParams)return void location.reload();e(t[n])}},e.prototype.handleShowIframeDialog=function(){var e=this.props.result.data;D("#baxia-dialog-content").contentDocument.write(e)},e.prototype.handleRenderNC=function(e){var n=this;O(t(t({},e),{renderTo:D("#baxia-nc-container"),verifiedCallback:function(t){E(e,{data:t},function(e){n.hide(e)})}}))},e.prototype.handleAutoSubmit=function(e,t){},e.prototype.fail=function(){},e.prototype.resend=function(){},e}())}();
